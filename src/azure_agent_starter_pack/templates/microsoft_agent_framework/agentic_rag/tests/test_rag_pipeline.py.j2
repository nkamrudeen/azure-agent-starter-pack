"""Unit tests for the RAG pipeline modules."""

from app.rag.chunker import chunk_text
from app.rag.config import CHUNK_OVERLAP, CHUNK_SIZE


def test_chunk_text_returns_chunks():
    text = "Hello world. " * 500
    chunks = chunk_text(text)
    assert len(chunks) > 1
    assert all("content" in c and "metadata" in c for c in chunks)


def test_chunk_text_respects_config():
    text = "A" * (CHUNK_SIZE * 3)
    chunks = chunk_text(text)
    for chunk in chunks:
        assert len(chunk["content"]) <= CHUNK_SIZE + CHUNK_OVERLAP + 50


def test_chunk_text_includes_metadata():
    chunks = chunk_text("Short text.", metadata={"source": "test.txt"})
    assert len(chunks) == 1
    assert chunks[0]["metadata"]["source"] == "test.txt"
    assert chunks[0]["metadata"]["chunk_index"] == 0


def test_chunk_text_empty_string():
    chunks = chunk_text("")
    assert len(chunks) == 0 or (len(chunks) == 1 and chunks[0]["content"] == "")
