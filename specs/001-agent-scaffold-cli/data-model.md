# Data Model: Azure Agent Starter Pack CLI

**Branch**: `001-agent-scaffold-cli` | **Date**: 2025-02-25  
**Source**: [spec.md](./spec.md) Key Entities + plan architecture.

## Entities

### Project Configuration

The set of user choices that fully define what is generated by `init`.

| Attribute | Type | Validation / Notes |
|-----------|------|--------------------|
| framework | enum | One of: `google_adk`, `microsoft_agent_framework`, `crewai`, `langgraph` |
| project_type | enum | One of: `multi_agent_api`, `multi_agent_react_ui`, `agentic_rag` |
| pipeline | enum | One of: `github_actions`, `azure_devops` |
| runtime | enum | One of: `aks`, `container_apps`, `app_service` |
| iac | enum | One of: `terraform`, `bicep` |
| target_dir | path | Absolute or relative; must be empty or overwrite flag set |
| template_version | string (optional) | Semver or tag; default = bundled/latest |
| overwrite | boolean | If true, allow init in non-empty directory |

**Relationships**: Valid (framework, project_type, pipeline, runtime, iac) combinations are constrained by compatibility matrix; invalid combination → fail fast (FR-022).

**State**: Immutable once resolved; used as input to Template Renderer and adapters.

---

### Template

Versioned set of files and rules used to produce a project. May be composed: base + framework + project type + runtime + pipeline.

| Attribute | Type | Validation / Notes |
|-----------|------|--------------------|
| id | string | Unique identifier (e.g. framework-project_type slug) |
| version | string | Semver or date-based; embedded in template metadata |
| roots | list of path | Template root directories (base, framework, project_type, runtime, pipeline) |
| manifest | TemplateManifest | List of template-owned paths for upgrade merge |
| context_defaults | map | Default Jinja2 context (overridable by adapters) |

**Relationships**: One Template is selected per Project Configuration (via adapter resolution). Templates are loaded from cache or network; cache used when fetch fails (FR-023).

**State**: Loaded once per init; immutable during render.

---

### TemplateManifest

Metadata for a template version used by upgrade to determine template-owned files.

| Attribute | Type | Validation / Notes |
|-----------|------|--------------------|
| template_version | string | Same as Template.version |
| owned_paths | list of path | Paths (relative to project root) that belong to template; safe to overwrite on upgrade |
| checksums | map (optional) | Path → checksum for conflict detection |

**Relationships**: One per Template; written into scaffolded project (e.g. `.azure-agent-starter-pack/manifest.json`) for upgrade command.

**State**: Written at scaffold time; read at upgrade time.

---

### Scaffolded Project

The output directory and files produced by init for a given configuration. Not a runtime entity; it is the artifact of init.

| Attribute | Type | Notes |
|-----------|------|--------|
| root | path | Target directory |
| config_snapshot | Project Configuration | Snapshot used to generate (for upgrade detection) |
| template_version | string | Version of templates used |
| manifest | TemplateManifest | Embedded for upgrade |
| structure | directory tree | Deterministic per NFR-001 |

**Relationships**: Produced by Template Renderer + adapters; input to upgrade command (FR-003).

---

### Pipeline Definition

The CI/CD workflow (e.g. YAML) included in the project for the selected pipeline provider.

| Attribute | Type | Notes |
|-----------|------|--------|
| provider | enum | `github_actions` \| `azure_devops` |
| path | path | Relative to project root (e.g. `.github/workflows/build.yaml`) |
| stages | list | Build, test, SAST, dependency scan, Docker build, push ACR, deploy |
| env_promotion | list | dev, stage, prod (per constitution) |

**Relationships**: Generated by Pipeline Generator adapter; one per scaffolded project.

---

### Doctor Result

Output of doctor command: required vs optional checks.

| Attribute | Type | Notes |
|-----------|------|--------|
| required_checks | list of CheckResult | Python/runtime, template access; fail doctor if any fail |
| optional_checks | list of CheckResult | Azure login, cloud CLI; report only, do not fail |
| overall_pass | boolean | True iff all required_checks pass |

| CheckResult | |
|-------------|--|
| name | string |
| passed | boolean |
| message | string (optional) |
| remediation | string (optional) |

**Relationships**: Produced by doctor command; required checks = what init needs (spec clarification).

---

## Validation Rules (from spec)

- **Init target directory**: Empty or overwrite=true (FR-021).
- **Option combination**: Must be in compatibility matrix; else fail fast, no partial generation (FR-022).
- **Template fetch**: Use cache when available; if no cache and fetch fails, fail with clear error (FR-023).
- **Determinism**: Same CLI version, template version, and Project Configuration → identical output (NFR-001).

---

## State Transitions

- **Init**: (Project Configuration, target_dir) → [validate config, validate dir, load templates, render, write] → Scaffolded Project.
- **Upgrade**: (project_root) → [read config_snapshot + manifest, load new template, auto-merge template-owned files, warn conflicts] → updated Scaffolded Project.
- **Doctor**: (none) → [run required checks, run optional checks] → Doctor Result; exit 0 iff overall_pass.
